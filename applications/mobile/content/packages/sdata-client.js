/*
 * 
 */
Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataBaseRequest=Ext.extend(Ext.util.Observable,{constructor:function(a){Sage.SData.Client.SDataBaseRequest.superclass.constructor.call(this);this.service=a;this.uri=new Sage.SData.Client.SDataUri();if(this.service){this.uri.setIncludeContent(this.service.getIncludeContent());this.uri.setServer(this.service.getVirtualDirectory()?this.service.getVirtualDirectory():"sdata");this.uri.setScheme(this.service.getProtocol());this.uri.setHost(this.service.getServerName());this.uri.setPort(this.service.getPort())}},getService:function(){return this.service},getUri:function(){return this.uri},setUri:function(a){this.uri=a;return this},getServerName:function(){return this.uri.getHost()},setServerName:function(a){this.uri.setHost(a);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(a){this.uri.setServer(a);return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(a){this.uri.setScheme(a);return this},getPort:function(){return this.uri.getPort()},setPort:function(a){this.uri.setPort(a);return this},getQueryArgs:function(){return this.uri.getQueryArgs()},setQueryArgs:function(a){this.uri.setQueryArgs(a);return this},getQueryArg:function(a){return this.uri.getQueryArg(a)},setQueryArg:function(a,b){this.uri.setQueryArg(a,b);return this},buildUrl:function(a){},toString:function(){var a=new Sage.SData.Client.SDataUri(this.uri);this.buildUrl(a);return a.toString()}});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataApplicationRequest=Ext.extend(Sage.SData.Client.SDataBaseRequest,{constructor:function(){Sage.SData.Client.SDataApplicationRequest.superclass.constructor.apply(this,arguments);if(this.service){this.uri.setProduct(this.service.getApplicationName()?this.service.getApplicationName():"-");this.uri.setContract(this.service.getContractName()?this.service.getContractName():"-");this.uri.setCompanyDataset(this.service.getDataSet()?this.service.getDataSet():"-")}},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(a){this.uri.setProduct(a);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(a){this.uri.setContract(a);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(a){this.uri.setCompanyDataset(a);return this},getResourceKind:function(){return this.resourceKind},setResourceKind:function(a){this.resourceKind=a;return this},buildUrl:function(a){Sage.SData.Client.SDataApplicationRequest.superclass.buildUrl.apply(this,arguments);a.appendPath(this.getResourceKind())}});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataResourceCollectionRequest=Ext.extend(Sage.SData.Client.SDataApplicationRequest,{constructor:function(){Sage.SData.Client.SDataResourceCollectionRequest.superclass.constructor.apply(this,arguments)},getCount:function(){return this.uri.getCount()},setCount:function(a){this.uri.setCount(a);return this},getStartIndex:function(){return this.uri.getStartIndex()},setStartIndex:function(a){this.uri.setStartIndex(a);return this},read:function(a){return this.service.readFeed(this,a)}});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataSingleResourceRequest=Ext.extend(Sage.SData.Client.SDataApplicationRequest,{constructor:function(){Sage.SData.Client.SDataSingleResourceRequest.superclass.constructor.apply(this,arguments);this.resourceSelector=false},read:function(a){return this.service.readEntry(this,a)},update:function(b,a){return this.service.updateEntry(this,b,a)},getResourceSelector:function(){return this.resourceSelector},setResourceSelector:function(a){this.resourceSelector=a;return this},buildUrl:function(a){Sage.SData.Client.SDataSingleResourceRequest.superclass.buildUrl.apply(this,arguments);if(this.resourceSelector){a.setCollectionPredicate(this.resourceSelector)}}});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataSystemRequest=Ext.extend(Sage.SData.Client.SDataBaseRequest,{constructor:function(){Sage.SData.Client.SDataSystemRequest.superclass.constructor.apply(this,arguments);this.category=false},getCategory:function(){return this.category},setCategory:function(a){this.category=a;return this},buildUrl:function(a){Sage.SData.Client.SDataSystemRequest.superclass.buildUrl.apply(this,arguments);a.appendPath("$system");if(this.category){a.appendPath(this.category)}},read:function(a){return this.service.readFeed(this,a)}});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataUri=Ext.extend(Ext.util.Observable,{constructor:function(a){Sage.SData.Client.SDataUri.superclass.constructor.call(this);this.scheme=Sage.SData.Client.SDataUri.Http;this.host="";this.server="";this.port=Sage.SData.Client.SDataUri.UnspecifiedPort;this.queryArgs={};this.pathSegments=[];this.startIndex=false;this.count=false;Ext.apply(this,a)},getScheme:function(){return this.scheme},setScheme:function(a){this.scheme=a;return this},getHost:function(){return this.host},setHost:function(a){this.host=a;return this},getPort:function(){return this.port},setPort:function(a){this.port=a;return this},getServer:function(){return this.server},setServer:function(a){this.server=a;return this},getQueryArgs:function(){return this.queryArgs},setQueryArgs:function(b,a){this.queryArgs=a!==true?Ext.apply(this.queryArgs,b):b;return this},getQueryArg:function(a){return this.queryArgs[a]},setQueryArg:function(a,b){this.queryArgs[a]=b;return this},getPathSegments:function(){return this.pathSegments},setPathSegments:function(a){this.pathSegments=a;return this},getPathSegment:function(a){return this.pathSegments.length>a?this.pathSegments[a]:false},setPathSegment:function(a,b){this.pathSegments[a]=typeof b==="string"?{text:b}:b;return this},getStartIndex:function(){return this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.StartIndex]?parseInt(this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.StartIndex]):false},setStartIndex:function(a){this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.StartIndex]=a;return this},getCount:function(){return this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.Count]?parseInt(this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.Count]):false},setCount:function(a){this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.Count]=a;return this},getIncludeContent:function(){return this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.IncludeContent]=="true"},setIncludeContent:function(a){this.queryArgs[Sage.SData.Client.SDataUri.QueryArgNames.IncludeContent]=a?"true":"false";return this},appendPath:function(a){this.pathSegments.push(typeof a==="string"?{text:a}:a);return this},toString:function(){var b=[];b.push(this.getScheme());b.push(Sage.SData.Client.SDataUri.SchemeSuffix);b.push(Sage.SData.Client.SDataUri.PathSegmentPrefix);b.push(Sage.SData.Client.SDataUri.PathSegmentPrefix);b.push(this.getHost());if(this.getPort()!==Sage.SData.Client.SDataUri.UnspecifiedPort){b.push(Sage.SData.Client.SDataUri.PortPrefix);b.push(this.getPort())}b.push(Sage.SData.Client.SDataUri.PathSegmentPrefix);var a=this.getPathSegments();var g=[];var f=this.getServer();if(f&&f.length>0){g=g.concat(f.split("/"))}for(var d=0;d<a.length;d++){if(typeof a[d]==="undefined"){continue}if(a[d]["predicate"]){g.push(encodeURIComponent(a[d]["text"]+"("+a[d]["predicate"]+")"))}else{g.push(encodeURIComponent(a[d]["text"]))}}b.push(g.join(Sage.SData.Client.SDataUri.PathSegmentPrefix));var h=this.getQueryArgs();var e=[];for(var c in h){e.push(encodeURIComponent(c)+Sage.SData.Client.SDataUri.QueryArgValuePrefix+encodeURIComponent(h[c]))}if(e.length>0){b.push(Sage.SData.Client.SDataUri.QueryPrefix);b.push(e.join(Sage.SData.Client.SDataUri.QueryArgPrefix))}return b.join("")},getProduct:function(){return this.getPathSegment(Sage.SData.Client.SDataUri.ProductPathIndex)},setProduct:function(a){return this.setPathSegment(Sage.SData.Client.SDataUri.ProductPathIndex,a)},getContract:function(){return this.getPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex)},setContract:function(a){return this.setPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex,a)},getCompanyDataset:function(){return this.getPathSegment(Sage.SData.Client.SDataUri.CompanyDatasetPathIndex)},setCompanyDataset:function(a){return this.setPathSegment(Sage.SData.Client.SDataUri.CompanyDatasetPathIndex,a)},getCollectionType:function(){return this.getPathSegment(Sage.SData.Client.SDataUri.CollectionTypePathIndex)},setCollectionType:function(a){return this.setPathSegment(Sage.SData.Client.SDataUri.CollectionTypePathIndex,a)},getCollectionPredicate:function(){var a=this.getPathSegment(Sage.SData.Client.SDataUri.CollectionTypePathIndex);return a&&a.predicate?a.predicate:false},setCollectionPredicate:function(b){var a=this.getPathSegment(Sage.SData.Client.SDataUri.CollectionTypePathIndex);if(a){a.predicate=b}return this}});Ext.apply(Sage.SData.Client.SDataUri,{Http:"http",Https:"https",PathSegmentPrefix:"/",PortPrefix:":",QueryArgPrefix:"&",QueryArgValuePrefix:"=",QueryPrefix:"?",SchemeSuffix:":",UnspecifiedPort:-1,UriName:"uri",QueryArgNames:{Count:"count",Exclude:"exclude",Format:"format",Include:"include",IncludeContent:"_includeContent",IncludeSchema:"includeSchema",Language:"language",OrderBy:"orderby",Precedence:"precedence",ReturnDelta:"returnDelta",Search:"search",Select:"select",StartIndex:"startIndex",Thumbnail:"thumbnail",TrackingID:"trackingID",Where:"where"},ProductPathIndex:0,ContractTypePathIndex:1,CompanyDatasetPathIndex:2,CollectionTypePathIndex:3,ServiceMethodSegment:"$service"});Ext.namespace("Sage.SData.Client");Sage.SData.Client.SDataService=Ext.extend(Ext.util.Observable,{constructor:function(){Sage.SData.Client.SDataService.superclass.constructor.apply(this,arguments);this.uri=new Sage.SData.Client.SDataUri();this.userAgent="Sage";this.username=false;this.password=""},getUri:function(){return this.uri},getUserName:function(){return this.username},setUserName:function(a){this.username=a;return this},getPassword:function(){return this.password},setPassword:function(a){this.password=a;return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(a){this.uri.setScheme(a);return this},getServerName:function(){return this.uri.getHost()},setServerName:function(a){this.uri.setHost(a);return this},getPort:function(){return this.uri.getPort()},setPort:function(a){this.uri.setPort(a);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(a){this.uri.setServer(a);return this},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(a){this.uri.setProduct(a);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(a){this.uri.setContract(a);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(a){this.uri.setCompanyDataset(a);return this},getIncludeContent:function(){return this.uri.getIncludeContent()},setIncludeContent:function(a){this.uri.setIncludeContent(a);return this},getUserAgent:function(){return this.userAgent},setUserAgent:function(a){this.userAgent=a;return this},createBasicAuthToken:function(){return"Basic "+Base64.encode(this.username+":"+this.password)},createHeadersForRequest:function(a){var b={"X-Authorization-Mode":"no-challenge"};if(this.username!==false){b.Authorization=b["X-Authorization"]=this.createBasicAuthToken()}return b},executeRequest:function(b,a,c){var d=Ext.apply({headers:{},method:"GET"},{url:b.toString(),scope:this,success:function(e,f){var g=this.processFeed(e.responseText);if(a.success){a.success.call(a.scope||this,g)}},failure:function(e,f){if(a.failure){a.failure.call(a.scope||this,e,f)}}},c);Ext.apply(d.headers,this.createHeadersForRequest(b));Ext.Ajax.request(d)},readFeed:function(b,a){this.executeRequest(b,a,{headers:{Accept:"application/atom+xml;type=feed"}})},readEntry:function(b,a){var c=Ext.apply({},{success:function(e){var d=e["$resources"][0]||false;if(a.success){a.success.call(a.scope||this,d)}}},a);this.executeRequest(b,c,{headers:{Accept:"application/atom+xml;type=entry"}})},updateEntry:function(e,d,c){var b=new XML.ObjTree();b.attr_prefix="@";var a=b.writeXML(this.formatEntry(d));this.executeRequest(e,Ext.apply({},{success:function(g){var f=g["$resources"][0]||false;if(c.success){c.success.call(c.scope||this,f)}}},c),{method:"PUT",xmlData:a,headers:{"Content-Type":"application/atom+xml;type=entry",Accept:"application/atom+xml;type=entry","If-Match":d["$etag"]}})},parseFeedXml:function(b){var a=new XML.ObjTree();a.attr_prefix="@";return a.parseXML(b)},convertEntity:function(f,a,c,b){b=b||{};b["$name"]=a;b["$key"]=c["@sdata:key"];b["$url"]=c["@sdata:uri"];var d=f+":";for(var i in c){if(i.indexOf(d)===0){var e=i.substring(d.length);var g=c[i];if(typeof g==="object"){if(g.hasOwnProperty("@xsi:nil")){var h=null}else{if(g.hasOwnProperty("@sdata:key")){var h=this.convertEntity(f,e,g)}}g=h}b[e]=g}}return b},formatEntity:function(c,b,e){e=e||{};e["@sdata:key"]=b["$key"];e["@sdata:uri"]=b["$url"];for(var a in b){if(/^\$/.test(a)){continue}var d=b[a];if(d==null){d={"@xsi:nil":"true"}}else{if(typeof d==="object"){d=this.formatEntity(c,d)}}e[a]=d}return e},convertEntry:function(f){var a={};a["$descriptor"]=f.title;a["$etag"]=f["http:etag"];a["$httpStatus"]=f["http:httpStatus"];var h=f["sdata:payload"];for(var d in h){if(h.hasOwnProperty(d)==false){continue}var g=d.split(":");if(g.length<2){continue}var e=g[0];var c=g[1];var b=h[d];this.convertEntity(e,c,b,a)}return a},formatEntry:function(b){var a={};a["@xmlns:sdata"]="http://schemas.sage.com/sdata/2008/1";a["@xmlns:xsi"]="http://www.w3.org/2001/XMLSchema-instance";a["@xmlns:http"]="http://schemas.sage.com/sdata/http/2008/1";a["@xmlns"]="http://www.w3.org/2005/Atom";a["http:etag"]=b["$etag"];a["sdata:payload"]={};a["sdata:payload"][b["$name"]]={"@xmlns":"http://schemas.sage.com/dynamic/2007"};this.formatEntity(false,b,a["sdata:payload"][b["$name"]]);return{entry:a}},convertFeed:function(c){var a={};if(c["opensearch:totalResults"]){a["$totalResults"]=parseInt(c["opensearch:totalResults"])}if(c["opensearch:startIndex"]){a["$startIndex"]=parseInt(c["opensearch:startIndex"])}if(c["opensearch:itemsPerPage"]){a["$itemsPerPage"]=parseInt(c["opensearch:itemsPerPage"])}if(c.link){a["$link"]={};for(var b=0;b<c.link.length;b++){a["$link"][c.link[b]["@rel"]]=c.link[b]["@href"]}if(a["$link"]["self"]){a["$url"]=a["$link"]["self"]}}a["$resources"]=[];if(Ext.isArray(c.entry)){for(var b=0;b<c.entry.length;b++){a["$resources"].push(this.convertEntry(c.entry[b]))}}else{if(typeof c.entry==="object"){a["$resources"].push(this.convertEntry(c.entry))}}return a},processFeed:function(b){var a=this.parseFeedXml(b);if(a.hasOwnProperty("feed")){return this.convertFeed(a.feed)}else{if(a.hasOwnProperty("entry")){return{"$resources":[this.convertEntry(a.entry)]}}else{return false}}}});