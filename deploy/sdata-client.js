/*
 * 
 */
(function(){var d=Sage,a=Sage.namespace("Sage.SData.Client.Ajax");var f=function(g){return((g>=200&&g<300)||g===304)};var b=function(k,j){if(k.readyState==4){if(f(k.status)){if(j.success){j.success.call(j.scope||this,k,j)}}else{if(k.status===0){var i=false;try{i=(k.statusText==="")}catch(g){i=true}if(i){var h=j.aborted||j.failure;if(h){h.call(j.scope||this,k,j)}}else{if(j.failure){j.failure.call(j.scope||this,k,j)}}}else{if(j.failure){j.failure.call(j.scope||this,k,j)}}}}};var c=function(h,g){h.onreadystatechange=function(){b.call(h,h,g)}};var e=function(h){var g=[];for(var i in h){g.push(encodeURIComponent(i)+"="+encodeURIComponent(h[i]))}return g.join("&")};Sage.apply(Sage.SData.Client.Ajax,{request:function(j){var j=d.apply({},j);j.params=d.apply({},j.params);j.headers=d.apply({},j.headers);if(j.cache!==true){j.params[j.cacheParam||"_t"]=(new Date()).getTime()}j.method=j.method||"GET";var g=e(j.params);if(g){j.url=j.url+(/\?/.test(j.url)?"&":"?")+g}var i=new XMLHttpRequest();if(j.user){i.open(j.method,j.url,j.async!==false,j.user,j.password);i.withCredentials=true}else{i.open(j.method,j.url,j.async!==false)}try{i.setRequestHeader("Accept",j.accept||"*/*");i.setRequestHeader("X-Requested-With","XMLHttpRequest");if(j.contentType){i.setRequestHeader("Content-Type",j.contentType)}for(var k in j.headers){i.setRequestHeader(k,j.headers[k])}}catch(h){}if(j.async!==false){c(i,j);i.send(j.body||null)}else{i.send(j.body||null);b(i,j)}return i},cancel:function(g){g.abort()}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataBaseRequest=Sage.Class.define({service:null,uri:null,completeHeaders:null,extendedHeaders:null,constructor:function(c){this.base.apply(this,arguments);this.service=c;this.completeHeaders={};this.extendedHeaders={};this.uri=new Sage.SData.Client.SDataUri();if(this.service){this.uri.setVersion(this.service.getVersion());this.uri.setIncludeContent(this.service.getIncludeContent());this.uri.setServer(this.service.getVirtualDirectory()?this.service.getVirtualDirectory():"sdata");this.uri.setScheme(this.service.getProtocol());this.uri.setHost(this.service.getServerName());this.uri.setPort(this.service.getPort())}},clone:function(){return new Sage.SData.Client.SDataBaseRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},setRequestHeader:function(c,d){this.completeHeaders[c]=d},extendRequestHeader:function(c,d){this.extendedHeaders[c]=d},clearRequestHeader:function(c){delete this.completeHeaders[c];delete this.extendedHeaders[c]},getAccept:function(){return this.extendedHeaders.Accept},setAccept:function(c){this.extendRequestHeader("Accept",c);return this},getService:function(){return this.service},getUri:function(){return this.uri},setUri:function(c){this.uri=c;return this},getServerName:function(){return this.uri.getHost()},setServerName:function(c){this.uri.setHost(c);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(c){this.uri.setServer(c);return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(c){this.uri.setScheme(c);return this},getPort:function(){return this.uri.getPort()},setPort:function(c){this.uri.setPort(c);return this},getQueryArgs:function(){return this.uri.getQueryArgs()},setQueryArgs:function(d,c){this.uri.setQueryArgs(d,c);return this},getQueryArg:function(c){return this.uri.getQueryArg(c)},setQueryArg:function(c,d){this.uri.setQueryArg(c,d);return this},build:function(c){return this.uri.build(c)},toString:function(c){return this.build(c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataApplicationRequest=Sage.SData.Client.SDataBaseRequest.extend({constructor:function(){this.base.apply(this,arguments);if(this.service){this.uri.setProduct(this.service.getApplicationName()?this.service.getApplicationName():"-");this.uri.setContract(this.service.getContractName()?this.service.getContractName():"-");this.uri.setCompanyDataset(this.service.getDataSet()?this.service.getDataSet():"-")}},clone:function(){return new Sage.SData.Client.SDataApplicationRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(c){this.uri.setProduct(c);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(c){this.uri.setContract(c);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(c){this.uri.setCompanyDataset(c);return this},getResourceKind:function(){return this.uri.getCollectionType()},setResourceKind:function(c){this.uri.setCollectionType(c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataResourceCollectionRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataResourceCollectionRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getCount:function(){return this.uri.getCount()},setCount:function(c){this.uri.setCount(c);return this},getStartIndex:function(){return this.uri.getStartIndex()},setStartIndex:function(c){this.uri.setStartIndex(c);return this},read:function(c){return this.service.readFeed(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataNamedQueryRequest=Sage.SData.Client.SDataResourceCollectionRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex,b.SDataUri.NamedQuerySegment)},clone:function(){return new Sage.SData.Client.SDataNamedQueryRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getQueryName:function(){return this.uri.getPathSegment(b.SDataUri.ResourcePropertyIndex+1)},setQueryName:function(c){this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex+1,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataSingleResourceRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataSingleResourceRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},read:function(c){return this.service.readEntry(this,c)},update:function(d,c){return this.service.updateEntry(this,d,c)},create:function(d,c){return this.service.createEntry(this,d,c)},"delete":function(d,c){return this.service.deleteEntry(this,d,c)},getResourceSelector:function(){return this.uri.getCollectionPredicate()},setResourceSelector:function(c){this.uri.setCollectionPredicate(c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataResourcePropertyRequest=Sage.SData.Client.SDataSingleResourceRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataResourcePropertyRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},readFeed:function(c){return this.service.readFeed(this,c)},getResourceProperty:function(){return this.uri.getPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex)},setResourceProperty:function(c){this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataSystemRequest=Sage.SData.Client.SDataBaseRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(Sage.SData.Client.SDataUri.ProductPathIndex,Sage.SData.Client.SDataUri.SystemSegment)},clone:function(){return new Sage.SData.Client.SDataSystemRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getCategory:function(){this.uri.getPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex)},setCategory:function(c){this.uri.setPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex,c);return this},read:function(c){return this.service.readFeed(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataTemplateResourceRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,Sage.SData.Client.SDataUri.TemplateSegment)},clone:function(){return new Sage.SData.Client.SDataTemplateResourceRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},read:function(c){return this.service.readEntry(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataServiceOperationRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex,b.SDataUri.ServiceMethodSegment)},clone:function(){return new Sage.SData.Client.SDataServiceOperationRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},execute:function(d,c){return this.service.executeServiceOperation(this,d,c)},getOperationName:function(){return this.uri.getPathSegment(b.SDataUri.ResourcePropertyIndex+1)},setOperationName:function(c){this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex+1,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataBatchRequest=Sage.SData.Client.SDataApplicationRequest.extend({items:null,constructor:function(){this.base.apply(this,arguments);this.items=[];this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,Sage.SData.Client.SDataUri.BatchSegment)},clone:function(){return new Sage.SData.Client.SDataBatchRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri)).setItems(this.items.slice(0))},getItems:function(){return this.items},setItems:function(c){this.items=c;return this},using:function(d,c){if(this.service){this.service.registerBatchScope(this)}else{throw"A service must be associated with the batch request."}try{d.call(c||this,this)}catch(f){this.service.clearBatchScope(this);throw f}this.service.clearBatchScope(this);return this},add:function(c){this.items.push(c)},commit:function(c){this.service.commitBatch(this,c)}})})();(function(){var a=Sage,c=Sage.namespace("Sage.SData.Client"),b=/^true$/i;Sage.SData.Client.SDataUri=Sage.Class.define({scheme:"http",host:"",server:"",port:-1,version:null,queryArgs:null,pathSegments:null,constructor:function(d){this.base.apply(this,arguments);a.apply(this,d);this.queryArgs=a.apply({},d&&d.queryArgs);this.pathSegments=(d&&d.pathSegments&&d.pathSegments.slice(0))||[];this.version=(d&&d.version&&a.apply({},d.version))||{major:1,minor:0}},clone:function(){return new Sage.SData.Client.SDataUri(this)},getVersion:function(){return this.version},setVersion:function(d){this.version=a.apply({major:0,minor:0},d);return this},getScheme:function(){return this.scheme},setScheme:function(d){this.scheme=d;return this},getHost:function(){return this.host},setHost:function(d){this.host=d;return this},getPort:function(){return this.port},setPort:function(d){this.port=d;return this},getServer:function(){return this.server},setServer:function(d){this.server=d;return this},getQueryArgs:function(){return this.queryArgs},setQueryArgs:function(e,d){this.queryArgs=d?e:a.apply(this.queryArgs,e);return this},getQueryArg:function(d){return this.queryArgs[d]},setQueryArg:function(d,e){this.queryArgs[d]=e;return this},getPathSegments:function(){return this.pathSegments},setPathSegments:function(d){this.pathSegments=d;return this},getPathSegment:function(d){return this.pathSegments.length>d?this.pathSegments[d]:false},setPathSegment:function(e,g,d){if(!g&&!d){this.pathSegments[e]=null}else{if(typeof g==="object"){this.pathSegments[e]=a.apply({},g,this.pathSegments[e])}else{var f={};if(g){f.text=g}if(d){f.predicate=d}this.pathSegments[e]=a.apply({},f,this.pathSegments[e])}}return this},getStartIndex:function(){return this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]?parseInt(this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]):-1},setStartIndex:function(d){this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]=d;return this},getCount:function(){return this.queryArgs[c.SDataUri.QueryArgNames.Count]?parseInt(this.queryArgs[c.SDataUri.QueryArgNames.Count]):-1},setCount:function(d){this.queryArgs[c.SDataUri.QueryArgNames.Count]=d;return this},getIncludeContent:function(){var d=this.version.major>=1?c.SDataUri.QueryArgNames.IncludeContent:c.SDataUri.QueryArgNames.LegacyIncludeContent;return b.test(this.queryArgs[d])},setIncludeContent:function(e){var d=this.version.major>=1?c.SDataUri.QueryArgNames.IncludeContent:c.SDataUri.QueryArgNames.LegacyIncludeContent;this.queryArgs[d]=""+e;return this},appendPath:function(e){var d=typeof e==="string"?{text:e}:e;this.pathSegments.push(d);return this},toString:function(d){return this.build(d)},build:function(e){var d=[];d.push(this.getScheme()||c.SDataUri.Http);d.push(c.SDataUri.SchemeSuffix);d.push(c.SDataUri.PathSegmentPrefix);d.push(c.SDataUri.PathSegmentPrefix);d.push(this.getHost());if(this.getPort()>0){d.push(c.SDataUri.PortPrefix,this.getPort())}d.push(c.SDataUri.PathSegmentPrefix);var j=this.getPathSegments();var n=[];var g=this.getServer();if(g&&g.length>0){n=n.concat(g.split("/"))}for(var h=0;h<j.length;h++){var k=j[h];if(k&&k.text){if(k.predicate){n.push(encodeURIComponent(k.text+"("+k.predicate+")"))}else{n.push(encodeURIComponent(k.text))}}}d.push(n.join(c.SDataUri.PathSegmentPrefix));if(e){return d.join("")}var f=this.getQueryArgs();var l=[];for(var m in f){l.push(encodeURIComponent(m)+c.SDataUri.QueryArgValuePrefix+encodeURIComponent(f[m]))}if(l.length>0){d.push(c.SDataUri.QueryPrefix);d.push(l.join(c.SDataUri.QueryArgPrefix))}return d.join("")},getProduct:function(){return this.getPathSegment(c.SDataUri.ProductPathIndex)},setProduct:function(d){return this.setPathSegment(c.SDataUri.ProductPathIndex,d)},getContract:function(){return this.getPathSegment(c.SDataUri.ContractTypePathIndex)},setContract:function(d){return this.setPathSegment(c.SDataUri.ContractTypePathIndex,d)},getCompanyDataset:function(){return this.getPathSegment(c.SDataUri.CompanyDatasetPathIndex)},setCompanyDataset:function(d){return this.setPathSegment(c.SDataUri.CompanyDatasetPathIndex,d)},getCollectionType:function(){return this.getPathSegment(c.SDataUri.CollectionTypePathIndex)},setCollectionType:function(d){return this.setPathSegment(c.SDataUri.CollectionTypePathIndex,d)},getCollectionPredicate:function(){var d=this.getPathSegment(c.SDataUri.CollectionTypePathIndex);return(d&&d.predicate)||false},setCollectionPredicate:function(d){return this.setPathSegment(c.SDataUri.CollectionTypePathIndex,{predicate:d})}});Sage.apply(Sage.SData.Client.SDataUri,{Http:"http",Https:"https",PathSegmentPrefix:"/",PortPrefix:":",QueryArgPrefix:"&",QueryArgValuePrefix:"=",QueryPrefix:"?",SchemeSuffix:":",UnspecifiedPort:-1,UriName:"uri",QueryArgNames:{Count:"count",Exclude:"exclude",Format:"format",Include:"include",IncludeContent:"_includeContent",LegacyIncludeContent:"includeContent",IncludeSchema:"includeSchema",Language:"language",OrderBy:"orderby",Precedence:"precedence",ReturnDelta:"returnDelta",Search:"search",Select:"select",StartIndex:"startIndex",Thumbnail:"thumbnail",TrackingID:"trackingID",Where:"where"},ProductPathIndex:0,ContractTypePathIndex:1,CompanyDatasetPathIndex:2,CollectionTypePathIndex:3,ResourcePropertyIndex:4,ServiceMethodSegment:"$service",TemplateSegment:"$template",SystemSegment:"$system",NamedQuerySegment:"$queries",BatchSegment:"$batch"})})();(function(){var c=Sage,e=Sage.namespace("Sage.SData.Client"),b=function(f){return typeof f!=="undefined"},a=function(f){return f&&f["#text"]?f["#text"]:f},d=/^(.+?):(.*)$/;Sage.SData.Client.SDataService=Sage.Evented.extend({uri:null,useCredentialedRequest:false,userAgent:"Sage",userName:false,password:"",batchScope:null,constructor:function(f){this.base.apply(this,arguments);this.uri=new Sage.SData.Client.SDataUri();if(f){if(b(f.uri)){this.uri=new Sage.SData.Client.SDataUri(f.uri)}if(b(f.version)){this.uri.setVersion(f.version)}if(b(f.serverName)){this.uri.setHost(f.serverName)}if(b(f.virtualDirectory)){this.uri.setServer(f.virtualDirectory)}if(b(f.applicationName)){this.uri.setProduct(f.applicationName)}if(b(f.contractName)){this.uri.setContract(f.contractName)}if(b(f.dataSet)){this.uri.setCompanyDataset(f.dataSet)}if(b(f.port)){this.uri.setPort(f.port)}if(b(f.protocol)){this.uri.setScheme(f.protocol)}if(b(f.includeContent)){this.uri.setIncludeContent(f.includeContent)}if(b(f.json)){this.json=f.json}if(b(f.userName)){this.userName=f.userName}if(b(f.password)){this.password=f.password}if(b(f.useCredentialedRequest)){this.useCredentialedRequest=f.useCredentialedRequest}}this.addEvents("beforerequest","requestcomplete","requestexception","requestaborted")},isJsonEnabled:function(){return this.json},enableJson:function(){this.json=true;return this},disableJson:function(){this.json=false;return this},getVersion:function(){return this.uri.getVersion()},setVersion:function(f){this.uri.setVersion(f);return this},getUri:function(){return this.uri},getUserName:function(){return this.userName},setUserName:function(f){this.userName=f;return this},getPassword:function(){return this.password},setPassword:function(f){this.password=f;return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(f){this.uri.setScheme(f);return this},getServerName:function(){return this.uri.getHost()},setServerName:function(f){this.uri.setHost(f);return this},getPort:function(){return this.uri.getPort()},setPort:function(f){this.uri.setPort(f);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(f){this.uri.setServer(f);return this},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(f){this.uri.setProduct(f);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(f){this.uri.setContract(f);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(f){this.uri.setCompanyDataset(f);return this},getIncludeContent:function(){return this.uri.getIncludeContent()},setIncludeContent:function(f){this.uri.setIncludeContent(f);return this},getUserAgent:function(){return this.userAgent},setUserAgent:function(f){this.userAgent=f;return this},registerBatchScope:function(f){this.batchScope=f},clearBatchScope:function(f){this.batchScope=null},createBasicAuthToken:function(){return"Basic "+Base64.encode(this.userName+":"+this.password)},createHeadersForRequest:function(f){var g={"X-Authorization-Mode":"no-challenge"};if(this.userName&&!this.useCredentialedRequest){g.Authorization=g["X-Authorization"]=this.createBasicAuthToken()}return g},extendAcceptRequestHeader:function(f,g){if(f){return f.split(/\s*,\s*/).join(";"+g+",")+";"+g}return f},executeRequest:function(g,f,h){if(this.json){g.setQueryArg("format","json")}var i=c.apply({async:f.async,headers:{},method:"GET",url:g.build()},{scope:this,success:function(j,k){var l=this.processFeed(j);this.fireEvent("requestcomplete",g,k,l);if(f.success){f.success.call(f.scope||this,l)}},failure:function(j,k){this.fireEvent("requestexception",g,k,j);if(f.failure){f.failure.call(f.scope||this,j,k)}},aborted:function(j,k){this.fireEvent("requestaborted",g,k,j);if(f.aborted){f.aborted.call(f.scope||this,j,k)}}},h);c.apply(i.headers,this.createHeadersForRequest(g),g.completeHeaders);if(g.extendedHeaders.Accept){i.headers.Accept=this.extendAcceptRequestHeader(i.headers.Accept,g.extendedHeaders.Accept)}if(this.userName&&this.useCredentialedRequest){i.user=this.userName;i.password=this.password}this.fireEvent("beforerequest",g,i);if(typeof i.result!=="undefined"){if(f.success){f.success.call(f.scope||this,i.result)}return}return e.Ajax.request(i)},abortRequest:function(f){e.Ajax.cancel(f)},readFeed:function(g,f){f=f||{};if(this.batchScope){this.batchScope.add({url:g.build(),method:"GET"});return}var h={headers:{Accept:this.json?"application/json,*/*":"application/atom+xml;type=feed,*/*"}};if(f.httpMethodOverride){if(this.json){g.setQueryArg("format","json")}h.headers["X-HTTP-Method-Override"]="GET";h.method="POST";h.body=g.build();h.url=g.build(true)}return this.executeRequest(g,f,h)},readEntry:function(g,f){f=f||{};if(this.batchScope){this.batchScope.add({url:g.build(),method:"GET"});return}var h=c.apply({},{success:function(j){var i=j["$resources"][0]||false;if(f.success){f.success.call(f.scope||this,i)}}},f);return this.executeRequest(g,h,{headers:{Accept:this.json?"application/json,*/*":"application/atom+xml;type=entry,*/*"}})},createEntry:function(i,h,g){g=g||{};if(this.batchScope){this.batchScope.add({url:i.build(),entry:h,method:"POST"});return}var k=c.apply({},{success:function(m){var l=m["$resources"][0]||false;if(g.success){g.success.call(g.scope||this,l)}}},g);var j=c.apply({},{method:"POST"});if(this.isJsonEnabled()){c.apply(j,{body:JSON.stringify(h),headers:{"Content-Type":"application/json"}})}else{var f=new XML.ObjTree();f.attr_prefix="@";c.apply(j,{body:f.writeXML(this.formatEntry(h)),headers:{"Content-Type":"application/atom+xml;type=entry",Accept:"application/atom+xml;type=entry,*/*"}})}return this.executeRequest(i,k,j)},updateEntry:function(i,h,g){g=g||{};if(this.batchScope){this.batchScope.add({url:i.build(),entry:h,method:"PUT",etag:h["$etag"]});return}var l=c.apply({},{success:function(n){var m=n["$resources"][0]||false;if(g.success){g.success.call(g.scope||this,m)}}},g);var k={},j={method:"PUT",headers:k};if(h["$etag"]&&!(g&&g.ignoreETag)){k["If-Match"]=h["$etag"]}if(this.isJsonEnabled()){k["Content-Type"]="application/json";j.body=JSON.stringify(h)}else{var f=new XML.ObjTree();f.attr_prefix="@";k["Content-Type"]="application/atom+xml;type=entry";k.Accept="application/atom+xml;type=entry,*/*";j.body=f.writeXML(this.formatEntry(h))}return this.executeRequest(i,l,j)},deleteEntry:function(h,g,f){f=f||{};if(this.batchScope){this.batchScope.add({url:h.build(),method:"DELETE",etag:!(f&&f.ignoreETag)&&g["$etag"]});return}var j={},i={method:"DELETE",headers:j};if(g["$etag"]&&!(f&&f.ignoreETag)){j["If-Match"]=g["$etag"]}return this.executeRequest(h,f,i)},executeServiceOperation:function(i,h,g){var k=c.apply({},{success:function(n){var m=n["$resources"][0]||false,l=m&&m.response,p=l&&l["$resources"],o=p&&p[0];if(o&&o["$name"]){m.response={};m.response[o["$name"]]=o}if(g.success){g.success.call(g.scope||this,m)}}},g);var j=c.apply({},{method:"POST"});if(this.isJsonEnabled()){c.apply(j,{body:JSON.stringify(h),headers:{"Content-Type":"application/json"}})}else{var f=new XML.ObjTree();f.attr_prefix="@";c.apply(j,{body:f.writeXML(this.formatEntry(h)),headers:{"Content-Type":"application/atom+xml;type=entry",Accept:"application/atom+xml;type=entry,*/*"}})}return this.executeRequest(i,k,j)},commitBatch:function(f,o){o=o||{};var j=f.getItems(),n,l,m={"$resources":[]};for(var g=0;g<j.length;g++){n=j[g];l=c.apply({},n.entry);if(n.url){l["$url"]=n.url}if(n.etag){l["$ifMatch"]=n.etag}if(n.method){l["$httpMethod"]=n.method}delete l["$etag"];m["$resources"].push(l)}var k=c.apply({},{method:"POST"});if(this.isJsonEnabled()){c.apply(k,{body:JSON.stringify(m),headers:{"Content-Type":"application/json"}})}else{var h=new XML.ObjTree();h.attr_prefix="@";c.apply(k,{body:h.writeXML(this.formatFeed(m)),headers:{"Content-Type":"application/atom+xml;type=feed",Accept:"application/atom+xml;type=feed,*/*"}})}return this.executeRequest(f,o,k)},parseFeedXml:function(g){var f=new XML.ObjTree();f.attr_prefix="@";return f.parseXML(g)},isIncludedReference:function(g,f,h){return h.hasOwnProperty("@sdata:key")},isIncludedCollection:function(i,g,j){if(j.hasOwnProperty("@sdata:key")){return false}if(j.hasOwnProperty("@sdata:uri")||j.hasOwnProperty("@sdata:url")){return true}var k,h;for(var f in j){if(f.charAt(0)==="@"){continue}k=j[f];break}if(k){if(c.isArray(k)){h=k[0]}else{h=k}if(h&&h.hasOwnProperty("@sdata:key")){return true}}return false},convertEntity:function(k,f,h,g){g=g||{};g["$name"]=f;g["$key"]=h["@sdata:key"];g["$url"]=h["@sdata:uri"];g["$uuid"]=h["@sdata:uuid"];for(var n in h){if(n.charAt(0)==="@"){continue}var o=d.exec(n),i=o?o[1]:false,j=o?o[2]:n,l=h[n];if(typeof l==="object"){if(l.hasOwnProperty("@xsi:nil")){var m=null}else{if(this.isIncludedReference(i,j,l)){var m=this.convertEntity(i,j,l)}else{if(this.isIncludedCollection(i,j,l)){var m=this.convertEntityCollection(i,j,l)}else{m=this.convertCustomEntityProperty(i,j,l)}}}l=m}g[j]=l}return g},convertEntityCollection:function(l,f,h){for(var o in h){if(o.charAt(0)==="@"){continue}var p=d.exec(o),j=p?p[1]:false,k=p?p[2]:o,m=h[o];if(c.isArray(m)){var n=[];for(var g=0;g<m.length;g++){n.push(this.convertEntity(l,k,m[g]))}return{"$resources":n}}else{return{"$resources":[this.convertEntity(l,k,m)]}}break}return null},convertCustomEntityProperty:function(g,f,h){return h},formatEntity:function(h,g,j){j=j||{};if(g["$key"]){j["@sdata:key"]=g["$key"]}for(var f in g){if(f.charAt(0)==="$"){continue}var i=g[f];if(i==null){i={"@xsi:nil":"true"}}else{if(typeof i==="object"&&i.hasOwnProperty("$resources")){i=this.formatEntityCollection(h,i)}else{if(typeof i==="object"){i=this.formatEntity(h,i)}}}j[f]=i}return j},formatEntityCollection:function(j,l){var f={};for(var h=0;h<l["$resources"].length;h++){var k=l["$resources"][h],g=k["$name"],m=(f[g]=f[g]||[]);m.push(this.formatEntity(j,l["$resources"][h]))}return f},convertEntry:function(k){var f={};f["$descriptor"]=k.title;f["$etag"]=k["http:etag"];f["$httpStatus"]=k["http:httpStatus"];var m=k["sdata:payload"];for(var i in m){if(i.charAt(0)==="@"){continue}if(m.hasOwnProperty(i)==false){continue}var l=i.split(":"),j,h,g=m[i];if(l.length==2){j=l[0];h=l[1]}else{if(l.length<2){j=false;h=i}else{continue}}this.convertEntity(j,h,g,f)}return f},formatEntry:function(g,h){var f={};if(!h){f["@xmlns:sdata"]="http://schemas.sage.com/sdata/2008/1";f["@xmlns:xsi"]="http://www.w3.org/2001/XMLSchema-instance";f["@xmlns:http"]="http://schemas.sage.com/sdata/http/2008/1";f["@xmlns"]="http://www.w3.org/2005/Atom"}if(g["$httpMethod"]){f["http:httpMethod"]=g["$httpMethod"]}if(g["$ifMatch"]){f["http:ifMatch"]=g["$ifMatch"]}if(g["$etag"]){f["http:etag"]=g["$etag"]}if(g["$url"]){f.id=g["$url"]}f["sdata:payload"]={};f["sdata:payload"][g["$name"]]={"@xmlns":"http://schemas.sage.com/dynamic/2007"};this.formatEntity(false,g,f["sdata:payload"][g["$name"]]);return{entry:f}},convertFeed:function(h){var f={};if(h["opensearch:totalResults"]){f["$totalResults"]=parseInt(a(h["opensearch:totalResults"]))}if(h["opensearch:startIndex"]){f["$startIndex"]=parseInt(a(h["opensearch:startIndex"]))}if(h["opensearch:itemsPerPage"]){f["$itemsPerPage"]=parseInt(a(h["opensearch:itemsPerPage"]))}if(h.link){f["$link"]={};for(var g=0;g<h.link.length;g++){f["$link"][h.link[g]["@rel"]]=h.link[g]["@href"]}if(f["$link"]["self"]){f["$url"]=f["$link"]["self"]}}f["$resources"]=[];if(c.isArray(h.entry)){for(var g=0;g<h.entry.length;g++){f["$resources"].push(this.convertEntry(h.entry[g]))}}else{if(typeof h.entry==="object"){f["$resources"].push(this.convertEntry(h.entry))}}return f},formatFeed:function(h){var f={};f["@xmlns:sdata"]="http://schemas.sage.com/sdata/2008/1";f["@xmlns:xsi"]="http://www.w3.org/2001/XMLSchema-instance";f["@xmlns:http"]="http://schemas.sage.com/sdata/http/2008/1";f["@xmlns"]="http://www.w3.org/2005/Atom";if(h["$url"]){f.id=h["$url"]}f.entry=[];for(var g=0;g<h["$resources"].length;g++){f.entry.push(this.formatEntry(h["$resources"][g],true)["entry"])}return{feed:f}},processFeed:function(f){if(!f.responseText){return null}var h=f.getResponseHeader&&f.getResponseHeader("Content-Type");if((h==="application/json")||(!h&&this.isJsonEnabled())){var g=JSON.parse(f.responseText);if(g.hasOwnProperty("$resources")){return g}else{return{"$resources":[g]}}}else{var g=this.parseFeedXml(f.responseText);if(g.hasOwnProperty("feed")){return this.convertFeed(g.feed)}else{if(g.hasOwnProperty("entry")){return{"$resources":[this.convertEntry(g.entry)]}}else{return false}}}}})})();